# 程序化动画Demo

## 效果展示

![](https://s4.ax1x.com/2022/02/19/Hbzu11.gif)

## 介绍

通过程序控制运动动画，使用逆运动学的原理。

蜘蛛怪物的每条腿都是使用fabrik算法进行运算。

## Fabric

每次迭代分为两次，一次正向一次反向。每次迭代的过程如下：

- 首先，针对一条从首端到尾端的bone chain，以及一个对应的Target point，先计算整条chain的长度，从而判断这个Target point是否可到达。
  - 如果不可到达，则要求根骨骼进行移动。通常的情境类似于一个人如果伸直了手或者一只长颈鹿伸长了脖子也无法够到目标点时，则此时需要自己本身就向目标点挪（在使用Jacobian矩阵计算的环境下，此时矩阵为irregular，无对应的逆可以算出来）。
  - 如果可以到达，那么这就意味着可以进行下一步的处理了，这里假设一共有五根骨骼（从根骨骼到末端骨骼分别是p0p0, p1p1,p2p2, p3p3,p4p4），与目标位置(t)。

- 如果整条骨骼链可以保证够得着的话，那么就可以开始进行FABRIK的处理。整体分为两步，首先，先从末端骨骼开始计算，先将最末端的骨骼p4p4移到目标位置t处，此时骨骼p4p4的位置为p′4p4′。

- 然后，将p3p3和p′4p4′连成一条直线，通过原有的p3p3和p4p4的距离，将现在的p3p3拉到与p′4p4′同样的距离处p′3p3′。一直处理到根骨骼p0p0

-  再之后，再从根骨骼p′0p0′开始处理。由于根骨骼再整个迭代过程中是默认为不动的，因此再把根骨骼p′′0p0″移到原来的位置p0p0处，接着使用同样的距离约束，一直处理到尾骨骼p4p4。

- 重复以上的迭代过程，直到最终的尾骨骼位置与到达目标位置（或与目标位置距离小于某个预定值）停止。

![](https://img-blog.csdn.net/20180506163521466)
